<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Networking Module - Sandpolis Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Networking Module";
    var mkdocs_page_input_path = "specification/com.sandpolis.core.net.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Sandpolis Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Tutorials</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../tutorials/getting_started/">Getting Started</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../tutorials/client/gui/">Using the desktop client</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../tutorials/client/terminal/">Using the terminal client</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Specification</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="#">General</a>
    <ul>
                <li class="toctree-l2"><a class="" href="../module.md">Module</a>
                </li>
                <li class="toctree-l2"><a class="" href="../instance.md">Instance</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Instances</a>
    <ul>
                <li class="toctree-l2"><a class="" href="../agent.md">Agent</a>
                </li>
                <li class="toctree-l2"><a class="" href="../server.md">Server</a>
                </li>
                <li class="toctree-l2"><a class="" href="../distagent.md">Distagent</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Messages</a>
    <ul>
                <li class="toctree-l2"><a class="" href="../clientserver.md">Client/Server</a>
                </li>
                <li class="toctree-l2"><a class="" href="../serveragent.md">Server/Agent</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Plugins</a>
    <ul>
                <li class="toctree-l2"><a class="" href="../plugins/desktop.md">Desktop Plugin</a>
                </li>
                <li class="toctree-l2"><a class="" href="../plugins/device.md">Device Plugin</a>
                </li>
                <li class="toctree-l2"><a class="" href="../plugins/filesystem.md">Filesystem Plugin</a>
                </li>
                <li class="toctree-l2"><a class="" href="../plugins/shell.md">Shell Plugin</a>
                </li>
                <li class="toctree-l2"><a class="" href="../plugins/snapshot.md">Snapshot Plugin</a>
                </li>
                <li class="toctree-l2"><a class="" href="../plugins/update.md">Update Plugin</a>
                </li>
    </ul>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">Implementation Reference</span></p>
                <ul>
                    <li class="toctree-l1"><a class="" href="../../application/client.md">Client</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../application/server.md">Server</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../application/agent.md">Agent</a>
                    </li>
                    <li class="toctree-l1"><a class="" href="../../application/network.md">Networking</a>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Sandpolis Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
    
    <li>Networking Module</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="networking-module">Networking Module</h1>
<h2 id="sandpolis-protocol">Sandpolis Protocol</h2>
<p>Sandpolis uses a custom binary protocol based on
<a href="https://developers.google.com/protocol-buffers">protocol buffers</a> for all
inter-instance network communications. By default, the server listens on TCP
port <strong>8768</strong>.</p>
<p>Most communication happens over TCP connections among instances and the server,
but the server can also coordinate direct TCP or UDP "sessions" between any two
instances that need to transfer high-volume or low-latency data.</p>
<h2 id="streams">Streams</h2>
<p>Many operations require real-time data for a short-lived or long-lived session.</p>
<p>All streams have a <em>source</em> and a <em>sink</em> and can exist between any two instances
(a stream where the source and sink reside on the same instance is called a
<em>local stream</em>). The source's purpose is to produce <em>stream events</em> at whatever
frequency is appropriate for the use-case and the sink's purpose is to consume
those stream events.</p>
<h3 id="multicasting">Multicasting</h3>
<p>Stream sources can push events to more than one sink simultaneously. This is
called multicasting and can save bandwidth in situations where multiple users
request the same resource at the same time.</p>
<h2 id="messages">Messages</h2>
<table>
<thead>
<tr>
<th>Message</th>
<th>Sources</th>
<th>Destinations</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>RQ_Session</td>
<td><code>client</code>, <code>agent</code></td>
<td><code>server</code></td>
<td></td>
</tr>
<tr>
<td>RS_Session</td>
<td><code>server</code></td>
<td><code>client</code>,<code>agent</code></td>
<td></td>
</tr>
<tr>
<td>RQ_AddConnection</td>
<td><code>client</code></td>
<td><code>server</code></td>
<td></td>
</tr>
<tr>
<td>RQ_CoordinateConnection</td>
<td><code>server</code></td>
<td><code>client</code>, <code>agent</code></td>
<td></td>
</tr>
<tr>
<td>EV_NetworkChanged</td>
<td><code>server</code></td>
<td><code>client</code>, <code>agent</code></td>
<td>Indicates that some node in the network has changed in connection status</td>
</tr>
<tr>
<td>RQ_InstallPlugin</td>
<td><code>client</code></td>
<td><code>server</code></td>
<td>Request that a new plugin be installed</td>
</tr>
<tr>
<td>RQ_STStream</td>
<td><code>client</code>, <code>agent</code></td>
<td><code>server</code></td>
<td>Request a new state tree sync stream</td>
</tr>
<tr>
<td>EV_STStreamData</td>
<td><code>server</code></td>
<td></td>
<td></td>
</tr>
<tr>
<td>RQ_CloseStream</td>
<td></td>
<td></td>
<td>Request that a stream be closed</td>
</tr>
</tbody>
</table>
<h2 id="session">Session</h2>
<p>Clients and agents maintain an ephemeral session which consists of a session
identifier and authentication state.</p>
<p>Session identifiers are 4-byte unsigned integers that have the instance type and
instance flavor encoded in them.</p>
<pre><code> 0         1         2           3
 012345678901234567890123 45678 901
[        Base CVID       | FID |IID]
</code></pre>
<h3 id="rq_coordinateconnection">RQ_CoordinateConnection</h3>
<p>Request that the receiving instance establish a new connection to the given
host. The receiver should attempt the connection as soon as possible.</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Requirements</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>host</td>
<td>string</td>
<td>An IP address</td>
<td>The connection host</td>
</tr>
<tr>
<td>port</td>
<td>int32</td>
<td>A valid port number</td>
<td>The connection port</td>
</tr>
<tr>
<td>protocol</td>
<td>string</td>
<td><code>tcp</code> or <code>udp</code></td>
<td>The connection protocol</td>
</tr>
<tr>
<td>encryption_key</td>
<td>bytes</td>
<td>64 bytes</td>
<td>The initial encryption key for the new connection</td>
</tr>
</tbody>
</table>
<h3 id="rq_ststream">RQ_STStream</h3>
<table>
<thead>
<tr>
<th>Field</th>
<th>Type</th>
<th>Requirements</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>stream_id</td>
<td>int32</td>
<td></td>
<td></td>
</tr>
<tr>
<td>oid</td>
<td>string</td>
<td></td>
<td></td>
</tr>
<tr>
<td>whitelist</td>
<td>repeated string</td>
<td></td>
<td></td>
</tr>
<tr>
<td>direction</td>
<td>string</td>
<td>"upstream", "downstream", or "bidirectional"</td>
<td></td>
</tr>
</tbody>
</table>
              
            </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
